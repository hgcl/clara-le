<script>
  // For the script to work, make sure the items container has the "filtered-list" class
  const allNotes = document.querySelectorAll(".filtered-list  >  *");
  const filterOneSelect = document.getElementById("filter-one-select");
  const filterTwoSelect = document.getElementById("filter-two-select");
  // remove no JS warning if javascript is enabled
  document.getElementById("notes-filter-js-warning").remove();

  // TODO clean up and simplify this script...

  /**
  * TODO Add URL change
  */

  /**
  * This function is called when a user changes the value of the select
  */
  function filterNotes() { // remove previous filter (hide all notes)
    allNotes.forEach((note) => note.hidden = true);

    // Take into account "All" options
    let emptyFilterOne = false;
    if (filterOneSelect.value == "") {
      emptyFilterOne = true;
    }

    /* There is only one filter */
    if (! filterTwoSelect) {
      allNotes.forEach((note) => {
        if (isInArray(note, "data-tag", filterOneSelect.value || emptyFilterOne)) {
          note.hidden = false
        }
      });
    }
    /* There are two filters */ else { // Take into account "All" options for 2nd filter
      let emptyFilterTwo = false;
      if (filterTwoSelect.value == "") {
        emptyFilterTwo = true;
      }

      // add hidden attributes to notes that don't have the chosen category in data-tag
      allNotes.forEach((note) => { // equals true if note includes filter 1
        const includesFilterOne = isInArray(note, "data-tag", filterOneSelect.value);

        // equals true is note includes filter 2
        const includesFilterTwo = isInArray(note, "data-tag-two", filterTwoSelect.value);

        if (filterTwoSelect && includesFilterOne && includesFilterTwo) {
          note.hidden = false;
        } else if (filterTwoSelect && emptyFilterOne && includesFilterTwo) {
          note.hidden = false;
        } else if (filterTwoSelect && includesFilterOne && emptyFilterTwo) {
          note.hidden = false;
        } else if (filterTwoSelect && emptyFilterOne && emptyFilterTwo) {
          note.hidden = false;
        }
      });
    }
  }

  // returns true if the 'array' selected under 'attribute' contains the 'value'
  function isInArray(array, attribute, value) {
    return array
      .getAttribute(attribute)
      .split(',')
      .includes(value);
  }
</script>