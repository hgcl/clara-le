<!--
template: /templates/default.html
title: "Search"
-->

<div id="search">
  <form id="search-form" role="search">
    <label for="search-bar">Search</label>
    <div>
      <input
        type="search"
        id="search-bar"
        autocomplete="none"
        autocorrect="none"
        autocapitalize="none"
        spellcheck="false"
      />
      <input type="reset" value="Reset" />
    </div>
    <button>Submit</button>
  </form>
  <ul class="result-list"></ul>
</div>

<script src="https://cdn.jsdelivr.net/npm/minisearch@6.3.0/dist/umd/index.min.js"></script>
<script type="module">
  import documents from "/postIndex.js";

  // Select DOM elements
  const searchPage = document.querySelector("#search");
  const searchForm = document.querySelector("#search-form");
  const searchInput = document.querySelector("#search-bar");
  const resultList = document.querySelector(".result-list");

  // Set up minisearch
  let miniSearch = new MiniSearch({
    fields: ["title", "text"], // fields to index for full-text search
    storeFields: ["title", "subtitle", "url", "dateCreated"], // fields to return with search results
  });

  // Fetch and index all documents
  miniSearch.addAll(documents);

  // Typing into search bar updates search results and suggestions
  searchForm.addEventListener("submit", (event) => {
    event.preventDefault(); // prevents search input being cleared on submit
    const query = searchInput.value;
    const results = query.length > 1 ? getSearchResults(query) : [];
    renderSearchResults(results);
  });

  const getSearchResults = (query) => {
    return miniSearch.search(query);
  };

  const renderSearchResults = (results) => {
    resultList.innerHTML = results
      .map(({ title, subtitle, url, dateCreated }) => {
        return `<li>
            <span class="details">
            <a href="${url}">${title}</a><span class="subtle">${subtitle}</span>
            </span>
        </li>`;
      })
      .join("\n");
  };
</script>
