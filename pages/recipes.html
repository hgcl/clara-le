<!--
template: /templates/default.html
buildScript: /scripts/buildRecipesList.js
-->

<h1>Recipe book</h1>
<p class="intro">
  Here is a collection of recipes I have bookmarked. The original recipes are
  linked in the posts directly. Some of the steps and ingredients might differ
  from the original instructions to suit my preferences.
</p>
<div id="posts-filter">
  <span class="sr-only">Select filters:</span>
  <button
    type="button"
    class="selectedTag"
    id="all"
    value="all"
    onclick="filterItems(value);"
  >
    All
  </button>
  <button type="button" id="main" value="main" onclick="filterItems(value);">
    Main
  </button>
  <button
    type="button"
    id="cereal"
    value="cereal"
    onclick="filterItems(value);"
  >
    Cereal
  </button>
  <button
    type="button"
    id="dessert"
    value="dessert"
    onclick="filterItems(value);"
  >
    Dessert
  </button>
  <button type="button" id="extra" value="extra" onclick="filterItems(value);">
    Extra
  </button>
  <details>
    <summary><span class="sr-only">More filters</span>...</summary>
    <button
      type="button"
      id="ahead"
      value="ahead"
      onclick="filterItems(value);"
    >
      Prep-ahead
    </button>
    <button
      type="button"
      id="preserve"
      value="preserve"
      onclick="filterItems(value);"
    >
      Preserve
    </button>
    <button type="button" id="diy" value="diy" onclick="filterItems(value);">
      DIY
    </button>
    <button
      type="button"
      id="spring"
      value="spring"
      onclick="filterItems(value);"
    >
      Spring
    </button>
    <button
      type="button"
      id="summer"
      value="summer"
      onclick="filterItems(value);"
    >
      Summer
    </button>
    <button type="button" id="fall" value="fall" onclick="filterItems(value);">
      Fall
    </button>
    <button
      type="button"
      id="winter"
      value="winter"
      onclick="filterItems(value);"
    >
      Winter
    </button>
  </details>
</div>
<ul id="recipes" class="nobullet">
  <li>Posts go here</li>
</ul>

<!-- Same script as posts.html -->
<script>
  // Set variables
  const completeLiList = [...document.querySelectorAll(`li[data-tag]`)];
  let selectedtag = "all";
  const allButtons = document.querySelectorAll("#posts-filter button");

  function filterItems(param) {
    if (param) {
      // Update URL onclick
      updateURL(param);
    }

    // Update CSS of current button and reset other buttons styles
    allButtons.forEach((button) => {
      button.removeAttribute("class");
    });
    const clickedButton = document.getElementById(param);
    clickedButton.setAttribute("class", "selectedTag");

    // Hide list items based on updated tags list
    let i = 0;
    while (i < completeLiList.length) {
      // Select <li> number i and get its tags
      let itemTags = completeLiList[i]
        .getAttribute("data-tag")
        .toLowerCase()
        .split(",");
      // Hide <li> if it doesn't include the selected param
      if ((param === "all") | (itemTags.includes(param) === true)) {
        completeLiList[i].setAttribute("style", "display:inherit");
      } else {
        completeLiList[i].setAttribute("style", "display:none");
      }
      i++;
    }
  }

  // Get current URL and apply filter to open page if necessary
  let currentUrl = new URL(window.location.href);
  const searchParams = new URLSearchParams(currentUrl.search);
  filterItems(searchParams.get("q"));

  // Align selected filter with URL
  function updateURL(filter) {
    // Update URL
    currentUrl.searchParams.set("q", filter);
    history.pushState({}, "", currentUrl);
  }
</script>
