<!--
template: /templates/media-pages.html
buildScript: /scripts/buildMediaPage.js
-->
<div
  id="dialog"
  role="dialog"
  aria-labelledby="dialog-title"
  aria-describedby="dialog-description"
  tabindex="-1"
  hidden
>
  <div class="dialog-content">
    <header>
      <h1 id="dialog-title">Title</h1>
      <p id="dialog-author" class="label">Author</p>
    </header>
    <section>
      <!-- TODO: ADD RATING -->
      <p id="dialog-details">
        They're not aliens, they're Earthâ€¦liens! Saving the world with meals on
        wheels. I hate yogurt. It's just stuff with bits in. Aw, you're all Mr.
        Grumpy Face today. You know how I sometimes have really brilliant ideas?
        Saving the world with meals on wheels. Father Christmas. Santa Claus. Or
        as I've always known him: Jeff. Annihilate? No. No violence. I won't
        stand for it. Not now, not ever, do you understand me?! I'm the Doctor,
        the Oncoming Storm - and you basically meant beat them in a football
        match, didn't you?
      </p>
    </section>
    <button
      type="button"
      aria-label="Close"
      id="close-dialog"
      onclick="toggleDialog('hide');"
    >
      <svg
        width="44"
        height="44"
        viewBox="0 0 44 44"
        aria-hidden="true"
        focusable="false"
      >
        <path
          d="M0.549989 4.44999L4.44999 0.549988L43.45 39.55L39.55 43.45L0.549989 4.44999Z"
        />
        <path
          d="M39.55 0.549988L43.45 4.44999L4.44999 43.45L0.549988 39.55L39.55 0.549988Z"
        />
      </svg>
    </button>
  </div>
</div>

<div class="grid">
  <div>Data generated here</div>
</div>
<script>
  // DIALOG: https://www.w3.org/WAI/GL/wiki/Using_ARIA_role%3Ddialog_to_implement_a_modal_dialog_box
  let dialogOpen = false,
    lastFocus,
    dialog,
    closeButton,
    pagebackground;

  function showDialog(el) {
    lastFocus = el || document.activeElement;
    toggleDialog("show");
  }
  function hideDialog(el) {
    toggleDialog("hide");
  }

  function toggleDialog(dialogState, title, author, rating) {
    dialog = document.getElementById("dialog");
    closeButton = document.getElementById("close-dialog");
    pagebackground = document.getElementById("main");

    if (dialogState === "show") {
      dialogOpen = true;

      // Replace content in dialog
      document.getElementById("dialog-title").innerHTML = title;
      document.getElementById("dialog-author").innerHTML = "by " + author;

      // show the dialog
      dialog.style.display = "flex";

      // after displaying the dialog, focus an element inside it
      closeButton.focus();

      // only hide the background *after* you've moved focus out of the content that will be "hidden"
      pagebackground.setAttribute("aria-hidden", "true");
    } else {
      dialogOpen = false;
      dialog.style.display = "none";
      pagebackground.setAttribute("aria-hidden", "false");
      lastFocus.focus();
    }
  }

  document.addEventListener(
    "focus",
    function (event) {
      const d = document.getElementById("dialog");

      if (dialogOpen && !d.contains(event.target)) {
        event.stopPropagation();
        d.focus();
      }
    },
    true
  );

  document.addEventListener(
    "keydown",
    function (event) {
      if (dialogOpen && event.keyCode === 27) {
        // ESC key
        toggleDialog("hide");
      }
    },
    true
  );
</script>
